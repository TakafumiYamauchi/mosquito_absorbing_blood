● 蚊取りゲーム - 実装仕様書

  1. ゲーム概要

  1.1 基本コンセプト

  - プレイヤーは蚊を操作し、血液を集めながら人間の手と蚊取り線香の煙を避けて生存する
  - インベーダーゲームのようなステージ制を採用
  - 10ステージ構成で、徐々に難易度が上昇
  - ステージ10は「かろうじてクリア可能」な高難易度

  1.2 勝利条件 ＆　プレイヤーが目指すもの

  - 10ステージすべてをクリアする
  - 各ステージは「集めた血液量 × 生存時間（秒）」が閾値を超えるとクリア
  - プレイヤーは、高いステージまで進出することと、より多くの血液量を採集することを目指す。

  1.3 敗北条件

  - ライフが0になる（初期ライフ：3）
  - ダメージ源：
    - 両手で挟まれる（片手だけでは無害）
    - 蚊取り線香の煙に触れる

  2. プレイヤー（蚊）の仕様

  2.1 基本パラメータ

  {
      size: 18,              // 蚊のサイズ
      speed: 8,              // 基本移動速度
      baseSpeed: 8,          // 速度の基準値
      blood: 0,              // 現在の血液保持量
      maxBlood: 12,          // 最大血液保持量
      lives: 3,              // 初期ライフ
      maxLives: 3,           // 基本最大ライフ
      invulnerableTime: 90   // ダメージ後の無敵時間（1.5秒）
  }

  2.2 移動システム

  - マウスまたはタッチで操作
  - 血液を集めるほど移動速度が低下（最大30%減速）
  - 計算式：speed = baseSpeed * (1 - (blood / maxBlood) * 0.3)

  2.3 ライフシステム

  - 血液を10個集めるごとに1ライフ回復（最大8ライフまで）
  - ライフ回復時は緑色のハートエフェクトと「LIFE UP!」表示

  2.4 ビジュアル

  - 詳細な蚊の描画：
    - 透明な羽（高速羽ばたきアニメーション）
    - 黒い胴体（頭部・胸部・腹部の3セグメント）
    - 腹部の縞模様（黒と茶色の交互）
    - 赤い複眼
    - 長い口器（針）
    - 6本の長い脚（3つの関節）
    - 血を吸うと腹部が赤く膨張

  3. 敵・障害物の仕様

  3.1 人間の手（ペア）

  基本仕様

  - 必ず左右のペアで登場
  - 画面外から出現（上下左右ランダム）
  - 蚊を追跡する動き
  - 両手で挟まれた時のみダメージ（片手接触は無害）

  動作パターン

  // 通常追跡時
  - 左右の手は開いた状態（spreadAngle: 0.4）で蚊を追跡
  - 各手は独立して蚊の方向へ移動

  // 挟み込み時
  - 手同士の距離 < 50 かつ 蚊との距離 < 100 の場合
  - 両手が互いに接近する動き（clapSpeed: 0.1）

  ビジュアル

  - リアルな手のひらの描画
  - グラデーションによる立体感
  - 5本の指（関節線、爪付き）
  - 手相（生命線、感情線）
  - 影による奥行き表現

  3.2 蚊取り線香の煙

  基本仕様

  - ステージ2から登場
  - 画面外から出現し、ゆっくり移動
  - 壁で反射
  - 触れると即ダメージ

  形状システム

  - 歪な円形（8-11個のポイントで構成）
  - ベジェ曲線で滑らかな輪郭
  - 時間経過で形状が変化（うねり効果）
  - 煙のパーティクル放出

  ビジュアル

  - グレーのグラデーション
  - 半透明（opacity: 0.6-0.9）
  - 赤い点線の警告境界線
  - 煙のパーティクル効果

  4. アイテム仕様

  4.1 血液ドロップ

  種類とポイント

  - 小（size: 6, points: 5）
  - 中（size: 10, points: 15）
  - 大（size: 14, points: 30）

  効果

  - スコア加算
  - 血液量増加（全サイズ共通：+1）
  - 移動速度低下（最大30%）
  - 10個ごとにライフ回復

  ビジュアル

  - 赤色の円形
  - パルスアニメーション
  - 光沢効果
  - ポイント表示（中・大のみ）

  5. ステージシステム

  5.1 ステージ進行条件

  - 血液量 × 生存時間（秒） >= 閾値 でステージクリア
  - ステージ10クリアでゲーム完全クリア

  5.2 ステージ別パラメータ

  | ステージ | 手の速度 | 手のペア数 | 煙の数 | 煙のサイズ | 煙の速度 | クリア閾値 |
  |------|------|-------|-----|-------|------|-------|
  | 1    | 1.2  | 1     | 0   | -     | -    | 30    |
  | 2    | 1.5  | 1     | 1   | 40    | 0.5  | 80    |
  | 3    | 1.8  | 2     | 1   | 50    | 0.8  | 150   |
  | 4    | 2.1  | 2     | 2   | 60    | 1.0  | 250   |
  | 5    | 2.4  | 3     | 2   | 70    | 1.2  | 400   |
  | 6    | 2.7  | 3     | 3   | 75    | 1.5  | 600   |
  | 7    | 3.0  | 4     | 3   | 80    | 1.8  | 850   |
  | 8    | 3.2  | 4     | 3   | 80    | 1.8  | 1100  |
  | 9    | 3.5  | 4     | 4   | 85    | 2.0  | 1400  |
  | 10   | 3.8  | 5     | 4   | 90    | 2.2  | ∞     |

  5.3 スポーンレート

  // ステージが上がるほど頻繁に出現
  handSpawnRate = Math.max(1200, 4500 - (currentStage * 250))
  bloodSpawnRate = Math.max(1200, 2500 - (currentStage * 100))
  smokeSpawnRate = Math.max(2500, 7000 - (currentStage * 350))

  // ステージ7以降は血液出現率アップ（救済措置）
  if (currentStage >= 7) {
      bloodSpawnRate = Math.max(1000, bloodSpawnRate - 200)
  }

  6. UI/UX仕様

  6.1 ゲーム画面UI

  - スコア表示
  - 血液ゲージ（現在/最大）
  - ライフ表示（ハートアイコン）
  - ステージ番号
  - 経過時間（MM:SS形式）
  - ステージ進捗バー

  6.2 画面構成

  - スタート画面
  - ゲームプレイ画面
  - ゲームオーバー画面（スコア、ステージ、時間表示）
  - ゲームクリア画面（豪華なエフェクト付き）

  6.3 エフェクト

  - 血液取得：赤いパーティクル
  - ダメージ：黄色いパーティクル
  - 手の挟み込み：オレンジ色のパーティクル＋「パチン！」テキスト
  - ライフ回復：緑のハートパーティクル
  - ステージクリア：金色のパーティクル

  7. 技術仕様

  7.1 実装技術

  - HTML5 Canvas API
  - JavaScript ES6（クラスベース）
  - requestAnimationFrame によるゲームループ

  7.2 ファイル構成

  mosquito_game/
  ├── index.html    # メインHTML
  ├── style.css     # スタイルシート
  ├── script.js     # ゲームロジック（MosquitoGameクラス）
  └── CLAUDE.md     # 開発ドキュメント

  7.3 主要メソッド

  - update(): ゲーム状態の更新
  - draw(): 描画処理
  - checkCollisions(): 衝突判定
  - spawnEnemies(): 敵・アイテムの生成
  - updateHandPairs(): 手の動き制御
  - updateSmokeAreas(): 煙の動き制御

  8. バランス調整のポイント

  8.1 難易度カーブ

  - ステージ1-3：チュートリアル的な難易度
  - ステージ4-6：適度な挑戦
  - ステージ7-9：高難度（救済措置あり）
  - ステージ10：極限の難易度（サバイバルモード）

  8.2 プレイヤー支援

  - 血液10個ごとのライフ回復（最大5ライフ）
  - 後半ステージでの血液出現率アップ
  - ダメージ後の無敵時間（1.5秒）
  - 視覚的に分かりやすい危険表示（赤い境界線）

  8.3 戦略性

  - 血液を集めるリスクとリワード（速度低下 vs ライフ回復）
  - 手の動きパターンの学習
  - 煙の移動予測
  - ステージごとの最適な立ち回り


